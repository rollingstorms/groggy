!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("GroggyVizCore",[],t):"object"==typeof exports?exports.GroggyVizCore=t():e.GroggyVizCore=t()}(this,()=>(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach(function(t){s(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function s(e,t,n){return(t=l(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,l(i.key),i)}}function l(e){var t=function(e){if("object"!=n(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,"string");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==n(t)?t:t+""}e.r(t),e.d(t,{GroggyVizCore:()=>V,GroggyVizCoreDefault:()=>F,InteractionEngine:()=>x,InteractionEngineDefault:()=>M,PhysicsEngine:()=>c,PhysicsEngineDefault:()=>u,SVGRenderer:()=>m,SVGRendererDefault:()=>w});var c=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=o({charge:-300,distance:50,damping:.9,iterations:100,threshold:.01,timeStep:.016},t),this.isRunning=!1,this.iteration=0,this.totalEnergy=0,console.log("⚡ PhysicsEngine initialized:",this.config)},t=[{key:"updatePositions",value:function(e,t,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.016;if(this.isRunning&&0!==e.length){var o=new Map;e.forEach(function(e){o.set(e.id,{x:0,y:0})}),this.calculateRepulsionForces(e,n,o),this.calculateAttractionForces(t,n,o),this.integrateForces(e,n,i,o,r),this.iteration++,this.totalEnergy=this.calculateTotalEnergy(i),this.totalEnergy<this.config.threshold&&this.pause()}}},{key:"calculateRepulsionForces",value:function(e,t,n){for(var i=0;i<e.length;i++)for(var r=i+1;r<e.length;r++){var o=e[i],s=e[r],a=t.get(o.id),l=t.get(s.id);if(a&&l){var c=l.x-a.x,u=l.y-a.y,h=Math.sqrt(c*c+u*u)||1,f=this.config.charge/(h*h),d=f*c/h,g=f*u/h,y=n.get(o.id),p=n.get(s.id);y.x-=d,y.y-=g,p.x+=d,p.y+=g}}}},{key:"calculateAttractionForces",value:function(e,t,n){var i=this;e.forEach(function(e){var r=t.get(e.source),o=t.get(e.target),s=n.get(e.source),a=n.get(e.target);if(r&&o&&s&&a){var l=o.x-r.x,c=o.y-r.y,u=Math.sqrt(l*l+c*c)||1,h=.1*(u-i.config.distance),f=h*l/u,d=h*c/u;s.x+=f,s.y+=d,a.x-=f,a.y-=d}})}},{key:"integrateForces",value:function(e,t,n,i,r){var o=this;e.forEach(function(e){var s=t.get(e.id),a=n.get(e.id),l=i.get(e.id);s&&a&&l&&(a.x+=l.x*r,a.y+=l.y*r,a.x*=o.config.damping,a.y*=o.config.damping,s.x+=a.x*r,s.y+=a.y*r,s.x=Math.max(50,Math.min(750,s.x)),s.y=Math.max(50,Math.min(550,s.y)))})}},{key:"calculateTotalEnergy",value:function(e){var t,n=0,r=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return i(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,l=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){l=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(l)throw s}}}}(e.values());try{for(r.s();!(t=r.n()).done;){var o=t.value;n+=o.x*o.x+o.y*o.y}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"start",value:function(){this.isRunning=!0,this.iteration=0,console.log("▶️ PhysicsEngine started")}},{key:"stop",value:function(){this.isRunning=!1,console.log("⏹️ PhysicsEngine stopped")}},{key:"pause",value:function(){this.isRunning=!1,console.log("⏸️ PhysicsEngine paused (converged)")}},{key:"updateConfig",value:function(e){this.config=o(o({},this.config),e),console.log("⚙️ PhysicsEngine config updated:",this.config)}},{key:"getState",value:function(){return{isRunning:this.isRunning,iteration:this.iteration,totalEnergy:this.totalEnergy,config:this.config}}},{key:"reset",value:function(){this.iteration=0,this.totalEnergy=0,console.log("🔄 PhysicsEngine reset")}}],t&&a(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();const u=c;function h(e){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h(e)}function f(e){return function(e){if(Array.isArray(e))return d(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return d(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?d(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach(function(t){p(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function p(e,t,n){return(t=b(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,b(i.key),i)}}function b(e){var t=function(e){if("object"!=h(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=h(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==h(t)?t:t+""}var m=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=y({width:800,height:600,nodeRadius:8,edgeWidth:1,nodeColor:"#007bff",edgeColor:"#999",backgroundColor:"#ffffff",enableLOD:!0,lodThreshold:1e3,enableLabels:!0,labelThreshold:100},t),this.element=null,this.svg=null,this.nodesGroup=null,this.edgesGroup=null,this.labelsGroup=null,this.frameCount=0,this.lastRenderTime=0,this.renderTimes=[],console.log("🎨 SVGRenderer initialized:",this.config)},t=[{key:"attachToElement",value:function(e){this.element=e,this.createSVGStructure(),console.log("🔗 SVGRenderer attached to element")}},{key:"createSVGStructure",value:function(){this.element&&(this.element.innerHTML="",this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.setAttribute("width",this.config.width),this.svg.setAttribute("height",this.config.height),this.svg.style.backgroundColor=this.config.backgroundColor,this.svg.style.border="1px solid #ddd",this.edgesGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.edgesGroup.setAttribute("class","edges"),this.nodesGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.nodesGroup.setAttribute("class","nodes"),this.labelsGroup=document.createElementNS("http://www.w3.org/2000/svg","g"),this.labelsGroup.setAttribute("class","labels"),this.svg.appendChild(this.edgesGroup),this.svg.appendChild(this.nodesGroup),this.svg.appendChild(this.labelsGroup),this.element.appendChild(this.svg))}},{key:"render",value:function(e){if(this.svg){var t=performance.now(),n=e.nodes,i=e.edges,r=e.positions,o=e.frameCount,s=this.config.enableLOD&&n.length>this.config.lodThreshold,a=this.config.enableLabels&&n.length<=this.config.labelThreshold;s?this.renderLOD(n,i,r):this.renderFull(n,i,r,a);var l=performance.now()-t;this.recordRenderTime(l),this.frameCount=o||this.frameCount+1}}},{key:"renderFull",value:function(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.renderEdges(t,n),this.renderNodes(e,n),i?this.renderLabels(e,n):this.labelsGroup.innerHTML=""}},{key:"renderLOD",value:function(e,t,n){this.renderEdgesLOD(t,n),this.renderNodesLOD(e,n),this.labelsGroup.innerHTML=""}},{key:"renderEdges",value:function(e,t){var n=this;this.edgesGroup.innerHTML="",e.forEach(function(e){var i=t.get?t.get(e.source):t[e.source],r=t.get?t.get(e.target):t[e.target];if(i&&r){var o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",i.x),o.setAttribute("y1",i.y),o.setAttribute("x2",r.x),o.setAttribute("y2",r.y),o.setAttribute("stroke",e.color||n.config.edgeColor),o.setAttribute("stroke-width",e.width||n.config.edgeWidth),o.setAttribute("opacity","0.8"),o.setAttribute("data-edge-id",e.id),n.edgesGroup.appendChild(o)}})}},{key:"renderEdgesLOD",value:function(e,t){var n=this;this.edgesGroup.innerHTML="",e.forEach(function(e){var i=t.get?t.get(e.source):t[e.source],r=t.get?t.get(e.target):t[e.target];if(i&&r){var o=document.createElementNS("http://www.w3.org/2000/svg","line");o.setAttribute("x1",i.x),o.setAttribute("y1",i.y),o.setAttribute("x2",r.x),o.setAttribute("y2",r.y),o.setAttribute("stroke",n.config.edgeColor),o.setAttribute("stroke-width","0.5"),o.setAttribute("opacity","0.6"),n.edgesGroup.appendChild(o)}})}},{key:"renderNodes",value:function(e,t){var n=this;this.nodesGroup.innerHTML="",e.forEach(function(e){var i=t.get?t.get(e.id):t[e.id];if(i){var r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",i.x),r.setAttribute("cy",i.y),r.setAttribute("r",e.size||n.config.nodeRadius),r.setAttribute("fill",e.color||n.config.nodeColor),r.setAttribute("stroke","#ffffff"),r.setAttribute("stroke-width","2"),r.setAttribute("opacity","0.9"),r.setAttribute("data-node-id",e.id),r.style.cursor="pointer",n.nodesGroup.appendChild(r)}})}},{key:"renderNodesLOD",value:function(e,t){var n=this;this.nodesGroup.innerHTML="",e.forEach(function(e){var i=t.get?t.get(e.id):t[e.id];if(i){var r=document.createElementNS("http://www.w3.org/2000/svg","circle");r.setAttribute("cx",i.x),r.setAttribute("cy",i.y),r.setAttribute("r","3"),r.setAttribute("fill",n.config.nodeColor),r.setAttribute("stroke","none"),r.setAttribute("opacity","0.8"),n.nodesGroup.appendChild(r)}})}},{key:"renderLabels",value:function(e,t){var n=this;this.labelsGroup.innerHTML="",e.forEach(function(e){if(e.label){var i=t.get?t.get(e.id):t[e.id];if(i){var r=document.createElementNS("http://www.w3.org/2000/svg","text");r.setAttribute("x",i.x),r.setAttribute("y",i.y-(e.size||n.config.nodeRadius)-5),r.setAttribute("text-anchor","middle"),r.setAttribute("font-family","Arial, sans-serif"),r.setAttribute("font-size","12"),r.setAttribute("fill","#333"),r.textContent=e.label,n.labelsGroup.appendChild(r)}}})}},{key:"recordRenderTime",value:function(e){this.renderTimes.push(e),this.renderTimes.length>60&&this.renderTimes.shift(),this.lastRenderTime=e}},{key:"getPerformanceStats",value:function(){if(0===this.renderTimes.length)return null;var e=this.renderTimes.reduce(function(e,t){return e+t},0)/this.renderTimes.length,t=Math.max.apply(Math,f(this.renderTimes)),n=Math.min.apply(Math,f(this.renderTimes));return{averageRenderTime:e.toFixed(2),maxRenderTime:t.toFixed(2),minRenderTime:n.toFixed(2),frameCount:this.frameCount,fps:(1e3/e).toFixed(1)}}},{key:"updateConfig",value:function(e){this.config=y(y({},this.config),e),this.svg&&(e.width||e.height)&&(this.svg.setAttribute("width",this.config.width),this.svg.setAttribute("height",this.config.height)),console.log("⚙️ SVGRenderer config updated:",this.config)}},{key:"clear",value:function(){this.nodesGroup&&(this.nodesGroup.innerHTML=""),this.edgesGroup&&(this.edgesGroup.innerHTML=""),this.labelsGroup&&(this.labelsGroup.innerHTML="")}},{key:"exportSVG",value:function(){return this.svg?(new XMLSerializer).serializeToString(this.svg):null}}],t&&v(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();const w=m;function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function S(e,t){if(e){if("string"==typeof e)return k(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(e,t):void 0}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach(function(t){E(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function E(e,t,n){return(t=C(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,C(i.key),i)}}function C(e){var t=function(e){if("object"!=O(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=O(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==O(t)?t:t+""}var x=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=P({enableDrag:!0,enableZoom:!0,enablePan:!0,enableMultiTouch:!0,dragThreshold:5,zoomSensitivity:.1,panSensitivity:1},t),this.element=null,this.callbacks=new Map,this.state={isDragging:!1,isPanning:!1,draggedNode:null,lastMousePos:{x:0,y:0},dragStartPos:{x:0,y:0},zoom:1,pan:{x:0,y:0}},this.listeners=new Map,console.log("🖱️ InteractionEngine initialized:",this.config)},t=[{key:"attachToElement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.element=e,this.callbacks=new Map(Object.entries(t)),this.setupEventListeners(),console.log("🔗 InteractionEngine attached to element")}},{key:"setupEventListeners",value:function(){this.element&&(this.addListener("mousedown",this.handleMouseDown.bind(this)),this.addListener("mousemove",this.handleMouseMove.bind(this)),this.addListener("mouseup",this.handleMouseUp.bind(this)),this.addListener("wheel",this.handleWheel.bind(this)),this.config.enableMultiTouch&&(this.addListener("touchstart",this.handleTouchStart.bind(this)),this.addListener("touchmove",this.handleTouchMove.bind(this)),this.addListener("touchend",this.handleTouchEnd.bind(this))),this.addListener("keydown",this.handleKeyDown.bind(this)),this.addListener("contextmenu",function(e){return e.preventDefault()}))}},{key:"addListener",value:function(e,t){this.element.addEventListener(e,t),this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t)}},{key:"handleMouseDown",value:function(e){e.preventDefault();var t=this.element.getBoundingClientRect(),n={x:e.clientX-t.left,y:e.clientY-t.top};this.state.lastMousePos=n,this.state.dragStartPos=P({},n);var i=e.target,r=i.getAttribute("data-node-id"),o=i.getAttribute("data-edge-id");r&&this.config.enableDrag?(this.state.draggedNode=r,this.state.isDragging=!1,this.emit("node_mousedown",{nodeId:r,position:n,event:e})):o?this.emit("edge_click",{edgeId:o,position:n,event:e}):this.config.enablePan&&(this.state.isPanning=!0)}},{key:"handleMouseMove",value:function(e){e.preventDefault();var t=this.element.getBoundingClientRect(),n={x:e.clientX-t.left,y:e.clientY-t.top},i=n.x-this.state.lastMousePos.x,r=n.y-this.state.lastMousePos.y;if(this.state.draggedNode){var o=Math.sqrt(Math.pow(n.x-this.state.dragStartPos.x,2)+Math.pow(n.y-this.state.dragStartPos.y,2));!this.state.isDragging&&o>this.config.dragThreshold&&(this.state.isDragging=!0,this.emit("drag_start",{nodeId:this.state.draggedNode,position:n})),this.state.isDragging&&this.emit("node_drag",{nodeId:this.state.draggedNode,position:n,delta:{x:i,y:r}})}else this.state.isPanning&&this.config.enablePan&&(this.state.pan.x+=i*this.config.panSensitivity,this.state.pan.y+=r*this.config.panSensitivity,this.emit("pan",{pan:P({},this.state.pan),delta:{x:i,y:r}}));this.state.lastMousePos=n}},{key:"handleMouseUp",value:function(e){e.preventDefault();var t=this.element.getBoundingClientRect(),n={x:e.clientX-t.left,y:e.clientY-t.top};this.state.draggedNode&&(this.state.isDragging?this.emit("drag_end",{nodeId:this.state.draggedNode,position:n}):this.emit("node_click",{nodeId:this.state.draggedNode,position:n,event:e}),this.state.draggedNode=null,this.state.isDragging=!1),this.state.isPanning&&(this.state.isPanning=!1,this.emit("pan_end",{pan:P({},this.state.pan)}))}},{key:"handleWheel",value:function(e){if(this.config.enableZoom){e.preventDefault();var t=this.element.getBoundingClientRect(),n={x:e.clientX-t.left,y:e.clientY-t.top},i=-e.deltaY*this.config.zoomSensitivity*.01,r=Math.max(.1,Math.min(5,this.state.zoom+i));r!==this.state.zoom&&(this.state.zoom=r,this.emit("zoom",{zoom:this.state.zoom,center:n,delta:i}))}}},{key:"handleTouchStart",value:function(e){if(e.preventDefault(),1===e.touches.length){var t=e.touches[0],n={clientX:t.clientX,clientY:t.clientY,target:t.target,preventDefault:function(){}};this.handleMouseDown(n)}}},{key:"handleTouchMove",value:function(e){if(e.preventDefault(),1===e.touches.length){var t=e.touches[0],n={clientX:t.clientX,clientY:t.clientY,preventDefault:function(){}};this.handleMouseMove(n)}}},{key:"handleTouchEnd",value:function(e){e.preventDefault();var t={clientX:this.state.lastMousePos.x,clientY:this.state.lastMousePos.y,preventDefault:function(){}};this.handleMouseUp(t)}},{key:"handleKeyDown",value:function(e){if("Space"===e.code&&(e.preventDefault(),this.resetView()),this.config.enablePan){var t=0,n=0;switch(e.code){case"ArrowLeft":t=-20;break;case"ArrowRight":t=20;break;case"ArrowUp":n=-20;break;case"ArrowDown":n=20}(t||n)&&(e.preventDefault(),this.state.pan.x+=t,this.state.pan.y+=n,this.emit("pan",{pan:P({},this.state.pan),delta:{x:t,y:n}}))}}},{key:"resetView",value:function(){this.state.zoom=1,this.state.pan={x:0,y:0},this.emit("view_reset",{zoom:this.state.zoom,pan:P({},this.state.pan)})}},{key:"processFrame",value:function(){}},{key:"emit",value:function(e,t){var n=this.callbacks.get(e);if(n)try{n(t)}catch(t){console.error("Error in interaction callback for ".concat(e,":"),t)}}},{key:"updateConfig",value:function(e){this.config=P(P({},this.config),e),console.log("⚙️ InteractionEngine config updated:",this.config)}},{key:"getState",value:function(){return P({},this.state)}},{key:"setState",value:function(e){this.state=P(P({},this.state),e)}},{key:"cleanup",value:function(){var e=this;if(this.element){var t,n=function(e){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=S(e))){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==t.return||t.return()}finally{if(s)throw r}}}}(this.listeners);try{var i=function(){var n=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(e,t)||S(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(t.value,2),i=n[0];n[1].forEach(function(t){e.element.removeEventListener(i,t)})};for(n.s();!(t=n.n()).done;)i()}catch(e){n.e(e)}finally{n.f()}this.listeners.clear(),console.log("🧹 InteractionEngine cleaned up")}}}],t&&A(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();const M=x;function D(e){return D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},D(e)}function T(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,r,o,s,a=[],l=!0,c=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=o.call(n)).done)&&(a.push(i.value),a.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(c)throw r}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return G(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?G(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach(function(t){R(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function R(e,t,n){return(t=N(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,N(i.key),i)}}function N(e){var t=function(e){if("object"!=D(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=D(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==D(t)?t:t+""}var V=function(){return e=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.nodes=t,this.edges=n,this.config=z(z({width:800,height:600},i),{},{physics:z({enabled:!0,charge:-300,distance:50,damping:.9,iterations:100},i.physics),rendering:z({width:i.width||800,height:i.height||600,nodeRadius:8,edgeWidth:1},i.rendering),interaction:z({enableDrag:!0,enableZoom:!0,enablePan:!0},i.interaction)}),this.physics=new c(this.config.physics),this.renderer=new m(this.config.rendering),this.interactions=new x(this.config.interaction),this.positions=new Map,this.velocities=new Map,this.isRunning=!1,this.frameCount=0,this.selectedNodes=new Set,this.nodePositions=this.positions,this.eventCallbacks=new Map,console.log("🎨 GroggyVizCore initialized:",{nodes:this.nodes.length,edges:this.edges.length,config:this.config})},t=[{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return e?this.applyFrameData(e):this.physics.updatePositions(this.nodes,this.edges,this.positions,this.velocities,1/60),this.renderer.render({nodes:this.nodes,edges:this.edges,positions:this.positions,frameCount:this.frameCount++}),this.interactions.processFrame(),this.emit("frame",{nodes:this.nodes,edges:this.edges,positions:this.positions,frameCount:this.frameCount}),this.getFrameData()}},{key:"applyFrameData",value:function(e){if(e.positions)for(var t=0,n=Object.entries(e.positions);t<n.length;t++){var i=T(n[t],2),r=i[0],o=i[1];this.positions.set(r,o)}e.nodes&&(this.nodes=e.nodes),e.edges&&(this.edges=e.edges)}},{key:"getFrameData",value:function(){return{nodes:this.nodes,edges:this.edges,positions:Object.fromEntries(this.positions),velocities:Object.fromEntries(this.velocities),frameCount:this.frameCount,timestamp:Date.now()}}},{key:"attachToDOM",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.element=e,this.eventCallbacks=new Map(Object.entries(n)),this.renderer.attachToElement(e),this.interactions.attachToElement(e,{onNodeDrag:function(e,n){t.positions.set(e,n),t.emit("node_drag",{nodeId:e,position:n})},onNodeClick:function(e){t.emit("node_click",{nodeId:e})},onEdgeClick:function(e){t.emit("edge_click",{edgeId:e})}}),console.log("🔗 GroggyVizCore attached to DOM element:",e)}},{key:"start",value:function(){this.isRunning=!0,this.physics.start(),this.animationLoop(),console.log("▶️ GroggyVizCore simulation started")}},{key:"stop",value:function(){this.isRunning=!1,this.physics.stop(),console.log("⏹️ GroggyVizCore simulation stopped")}},{key:"animationLoop",value:function(){var e=this;this.isRunning&&(this.update(),requestAnimationFrame(function(){return e.animationLoop()}))}},{key:"on",value:function(e,t){this.eventCallbacks.has(e)||this.eventCallbacks.set(e,[]),this.eventCallbacks.get(e).push(t)}},{key:"emit",value:function(e,t){this.eventCallbacks.has(e)&&this.eventCallbacks.get(e).forEach(function(n){try{n(t)}catch(t){console.error("Error in event callback for ".concat(e,":"),t)}})}},{key:"setData",value:function(e,t){var n=this;this.nodes=e,this.edges=t,this.positions.clear(),this.velocities.clear(),this.frameCount=0,this.nodes.forEach(function(e,t){if(!n.positions.has(e.id)){var i=2*t*Math.PI/n.nodes.length,r=Math.min(n.config.rendering.width,n.config.rendering.height)/4;n.positions.set(e.id,{x:n.config.rendering.width/2+r*Math.cos(i),y:n.config.rendering.height/2+r*Math.sin(i)})}n.velocities.has(e.id)||n.velocities.set(e.id,{x:0,y:0})}),this.emit("data_updated",{nodes:e,edges:t}),console.log("📊 GroggyVizCore data updated:",{nodes:e.length,edges:t.length})}},{key:"getConfig",value:function(){return z({},this.config)}},{key:"updateConfig",value:function(e){this.config=z(z(z({},this.config),e),{},{physics:z(z({},this.config.physics),e.physics),rendering:z(z({},this.config.rendering),e.rendering),interaction:z(z({},this.config.interaction),e.interaction)}),this.physics.updateConfig(this.config.physics),this.renderer.updateConfig(this.config.rendering),this.interactions.updateConfig(this.config.interaction),this.emit("config_updated",this.config),console.log("⚙️ GroggyVizCore config updated:",this.config)}},{key:"exportState",value:function(){return{nodes:this.nodes,edges:this.edges,positions:Object.fromEntries(this.positions),velocities:Object.fromEntries(this.velocities),selectedNodes:Array.from(this.selectedNodes),config:this.config,frameCount:this.frameCount,timestamp:Date.now()}}},{key:"destroy",value:function(){this.stop(),this.interactions&&"function"==typeof this.interactions.cleanup&&this.interactions.cleanup(),this.renderer&&"function"==typeof this.renderer.clear&&this.renderer.clear(),this.positions.clear(),this.velocities.clear(),this.selectedNodes.clear(),this.eventCallbacks.clear(),this.element=null,this.nodes=[],this.edges=[],console.log("🧹 GroggyVizCore destroyed")}}],t&&I(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();const F=V;return console.log("🎨 Unified Visualization Core loaded"),t})());
//# sourceMappingURL=groggy-viz-core.standalone.js.map